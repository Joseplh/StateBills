<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BoxSite: ms-rest-nodeauth &lt;a href=&quot;https://dev.azure.com/azure-public/adx/_build/latest?definitionId=9&quot;&gt;&lt;img src=&quot;https://dev.azure.com/azure-public/adx/_apis/build/status/public.Azure.ms-rest-nodeauth&quot; alt=&quot;Build Status&quot;/&gt;&lt;/a&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BoxSite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__c___users__joseph_workspace__state_bills__box_site_frontend_node_modules__0dazure_ms-rest-nodeauth__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ms-rest-nodeauth <a href="https://dev.azure.com/azure-public/adx/_build/latest?definitionId=9"><img src="https://dev.azure.com/azure-public/adx/_apis/build/status/public.Azure.ms-rest-nodeauth" alt="Build Status" class="inline"/></a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library provides different node.js based authentication mechanisms for services in Azure. It also contains rich type definitions thereby providing a good TypeScript experience. All the authentication methods support callbacks as well as promises. If they are called within an async method in your application then you can use the async/await pattern as well.</p>
<h2><a class="anchor" id="autotoc_md100"></a>
Example</h2>
<h2><a class="anchor" id="autotoc_md101"></a>
username/password based login</h2>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line"> </div>
<div class="line">const username = process.env[&quot;AZURE_USERNAME&quot;];</div>
<div class="line">const password = process.env[&quot;AZURE_PASSWORD&quot;];</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithUsernamePasswordWithAuthResponse(username, password).then((authres) =&gt; {</div>
<div class="line">  console.dir(authres, { depth: null })</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md102"></a>
service-principal and secret based login</h2>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line"> </div>
<div class="line">const clientId = process.env[&quot;CLIENT_ID&quot;];</div>
<div class="line">const secret = process.env[&quot;APPLICATION_SECRET&quot;];</div>
<div class="line">const tenantId = process.env[&quot;DOMAIN&quot;];</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithServicePrincipalSecretWithAuthResponse(clientId, secret, tenantId).then((authres) =&gt; {</div>
<div class="line">  console.dir(authres, { depth: null })</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md103"></a>
service-principal and certificate based login by providing an ABSOLUTE file path to the .pem file</h3>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line"> </div>
<div class="line">const clientId = process.env[&quot;CLIENT_ID&quot;];</div>
<div class="line">const tenantId = process.env[&quot;DOMAIN&quot;];</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithServicePrincipalCertificateWithAuthResponse(clientId, &quot;/Users/user1/foo.pem&quot;, tenantId).then((authres) =&gt; {</div>
<div class="line">  console.dir(authres, { depth: null })</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md104"></a>
service-principal and certificate based login by providing the certificate and private key (contents of the .pem file)</h3>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line"> </div>
<div class="line">const clientId = process.env[&quot;CLIENT_ID&quot;];</div>
<div class="line">const tenantId = process.env[&quot;DOMAIN&quot;];</div>
<div class="line">const certificate = </div>
<div class="line">`</div>
<div class="line">-----BEGIN PRIVATE KEY-----</div>
<div class="line">xxxxxxxxxxxxxxxxx</div>
<div class="line">xxxxxxxxxxxxxxxxx</div>
<div class="line">-----END PRIVATE KEY-----</div>
<div class="line">-----BEGIN CERTIFICATE-----</div>
<div class="line">yyyyyyyyyyyyyyyyy</div>
<div class="line">yyyyyyyyyyyyyyyyy</div>
<div class="line">-----END CERTIFICATE-----</div>
<div class="line">`;</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithServicePrincipalCertificateWithAuthResponse(clientId, certificate, tenantId).then((authres) =&gt; {</div>
<div class="line">  console.dir(authres, { depth: null })</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md105"></a>
interactive/device-code flow login</h2>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.interactiveLoginWithAuthResponse().then((authres) =&gt; {</div>
<div class="line">  console.dir(authres, { depth: null })</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md106"></a>
service-principal authentication from auth file on disk</h2>
<p>Before using this method please install az cli from <a href="https://github.com/Azure/azure-cli/releases">https://github.com/Azure/azure-cli/releases</a>. Then execute <code>az ad sp create-for-rbac --sdk-auth &gt; ${yourFilename.json}</code>.</p>
<p>If you want to create the sp for a different cloud/environment then please execute:</p><ol type="1">
<li>az cloud list</li>
<li>az cloud set â€“n &lt;name of the environment&gt;</li>
<li><p class="startli">az ad sp create-for-rbac &ndash;sdk-auth &gt; auth.json // create sp with <b>secret</b>. </p><pre class="fragment">   OR
</pre><p class="startli">az ad sp create-for-rbac &ndash;create-cert &ndash;sdk-auth &gt; auth.json // create sp with <b>certificate</b>. If the service principal is already created then login with service principal info:</p>
</li>
<li>az login &ndash;service-principal -u <code>&lt;clientId&gt;</code> -p <code>&lt;clientSecret&gt;</code> -t <code>&lt;tenantId&gt;</code></li>
<li>az account show &ndash;sdk-auth &gt; auth.json</li>
</ol>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;../lib/msRestNodeAuth&quot;;</div>
<div class="line"> </div>
<div class="line">const options: msRestNodeAuth.LoginWithAuthFileOptions = {</div>
<div class="line">  filePath: &quot;&lt;file path to auth file&gt;&quot;,</div>
<div class="line">}</div>
<div class="line">msRestNodeAuth.loginWithAuthFileWithAuthResponse(options).then((authRes) =&gt; {</div>
<div class="line">  console.log(authRes);</div>
<div class="line">  console.log(process.env[&quot;AZURE_SUBSCRIPTION_ID&quot;]);</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md107"></a>
MSI (Managed Service Identity) based login from a virtual machine created in Azure.</h2>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;../lib/msRestNodeAuth&quot;;</div>
<div class="line"> </div>
<div class="line">const options: msRestNodeAuth.MSIVmOptions = {</div>
<div class="line">  port: 50342;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithVmMSI(options).then((msiTokenRes) =&gt; {</div>
<div class="line">  console.log(msiTokenRes);</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md108"></a>
MSI (Managed Service Identity) based login from an AppService or Azure Function created in Azure.</h2>
<div class="fragment"><div class="line">import * as msRestNodeAuth from &quot;../lib/msRestNodeAuth&quot;;</div>
<div class="line"> </div>
<div class="line">const options: msRestNodeAuth.MSIAppServiceOptions = {</div>
<div class="line">  msiEndpoint: &quot;http://127.0.0.1:41741/MSI/token/&quot;;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">msRestNodeAuth.loginWithAppServiceMSI(options).then((msiTokenRes) =&gt; {</div>
<div class="line">  console.log(msiTokenRes);</div>
<div class="line">}).catch((err) =&gt; {</div>
<div class="line">  console.log(err);</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md109"></a>
Getting credentials via Azure CLI.</h2>
<p><b>Pre-requisite</b></p><ul>
<li><b>Install azure-cli</b>. For more information see <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">here</a>.</li>
<li><b>Login via <code>az login</code></b></li>
<li>Detailed sample over <a href="./samples/getCredentialsFromAzureCli.ts">here</a>.</li>
</ul>
<div class="fragment"><div class="line">import { AzureCliCredentials } from &quot;@azure/ms-rest-nodeauth&quot;;</div>
<div class="line">import { ServiceClient, RequestPrepareOptions } from &quot;@azure/ms-rest-js&quot;;</div>
<div class="line"> </div>
<div class="line">async function main(): Promise&lt;void&gt; {</div>
<div class="line">  try {</div>
<div class="line">    // Please make sure you have logged in via Azure CLI `az login` before executing this script.</div>
<div class="line">    const creds = await AzureCliCredentials.create();</div>
<div class="line">    const client = new ServiceClient(creds);</div>
<div class="line">    console.log(&quot;&gt;&gt;&gt; Subscription associated with the access token: &#39;%s&#39;.&quot;,</div>
<div class="line">      creds.tokenInfo.subscription);</div>
<div class="line"> </div>
<div class="line">    const request: RequestPrepareOptions = {</div>
<div class="line">      url: getUrl(creds.subscriptionInfo.id),</div>
<div class="line">      method: &quot;GET&quot;</div>
<div class="line">    };</div>
<div class="line">    console.log(&quot;&gt;&gt;&gt; Request url: &#39;%s&#39;.&quot;, request.url);</div>
<div class="line"> </div>
<div class="line">    const res = await client.sendRequest(request);</div>
<div class="line">    console.log(&quot;List of resource groups from subscriptionId &#39;%s&#39;: \n%O&quot;,</div>
<div class="line">      creds.subscriptionInfo.id, res.parsedBody);</div>
<div class="line"> </div>
<div class="line">    // Let us change the subscriptionId, which should trigger refreshing the access token.</div>
<div class="line">    const subscriptions = await AzureCliCredentials.listAllSubscriptions();</div>
<div class="line">    creds.subscriptionInfo = subscriptions[1];</div>
<div class="line"> </div>
<div class="line">    console.log(&quot;&gt;&gt;&gt; The new subscription id associated with the credential object is: &#39;%s&#39;.&quot;,</div>
<div class="line">      creds.subscriptionInfo.id);</div>
<div class="line">    request.url = getUrl(creds.subscriptionInfo.id);</div>
<div class="line">    console.log(&quot;&gt;&gt;&gt; Request url: &#39;%s&#39;.&quot;, request.url);</div>
<div class="line"> </div>
<div class="line">    const res2 = await client.sendRequest(request);</div>
<div class="line">    console.log(&quot;List of resource groups from subscriptionId &#39;%s&#39;: \n%O&quot;,</div>
<div class="line">      creds.subscriptionInfo.id, res2.parsedBody);</div>
<div class="line"> </div>
<div class="line">    console.log(&quot;&gt;&gt;&gt; Subscription associated with the access token: &#39;%s&#39;.&quot;,</div>
<div class="line">      creds.tokenInfo.subscription);</div>
<div class="line">  } catch (err) {</div>
<div class="line">    console.log(err);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">function getUrl(subscriptionId: string): string {</div>
<div class="line">  return `https://management.azure.com/subscriptions/${subscriptionId}/resourcegroups?api-version=2018-05-01`;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">main();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md110"></a>
Contributing</h2>
<p>This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit <a href="https://cla.microsoft.com">https://cla.microsoft.com</a>.</p>
<p>When you submit a pull request, a CLA-bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., label, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA.</p>
<p>This project has adopted the <a href="https://opensource.microsoft.com/codeofconduct/">Microsoft Open Source Code of Conduct</a>. For more information see the <a href="https://opensource.microsoft.com/codeofconduct/faq/">Code of Conduct FAQ</a> or contact <a href="#" onclick="location.href='mai'+'lto:'+'ope'+'nc'+'ode'+'@m'+'icr'+'os'+'oft'+'.c'+'om'; return false;">opencode@microsoft.com</a> with any additional questions or comments. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19 </li>
  </ul>
</div>
</body>
</html>
